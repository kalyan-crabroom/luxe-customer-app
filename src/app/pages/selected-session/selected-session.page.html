<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" defaultHref="/" icon="assets/icons/back-btn-arrow.svg"></ion-back-button>
    </ion-buttons>
    <ion-title>Session Request</ion-title>
    <ion-buttons slot="end">

      <ion-button (click)="chat(bookingDetails)" *ngIf="bookingDetails?.id && bookingDetails?.status != '1'">
        <ion-icon name="chatbubbles"></ion-icon>
      </ion-button>

      <!-- <ion-button type="button" id="click-trigger" *ngIf="bookingDetails?.status == '1' && helptext">
        <ion-icon name="help-circle"></ion-icon>
      </ion-button> -->

    </ion-buttons>

  </ion-toolbar>

  <!-- <ion-popover trigger="click-trigger" triggerAction="click" *ngIf="bookingDetails?.status == '1' && helptext">
    <ng-template>
      <ion-content class="ion-padding">
        <p class="text-white help-text" [innerHTML]="helptext.content"></p>
      </ion-content>
    </ng-template>
  </ion-popover> -->

</ion-header>
<ion-content>
  <ion-grid class="ion-padding" [fixed]="true">

    <ion-row *ngIf="!ready">

      <ion-col size="12" class="ion-text-center">
        <ion-spinner color="light"></ion-spinner>
      </ion-col>

    </ion-row>


    <ion-row *ngIf="ready && bookingDetails.length == 0">
      <ion-col size="12">
        <div>
          <p class="no-location">{{ error_meessage }}</p>
        </div>
      </ion-col>
    </ion-row>


    <ng-container *ngIf="ready && bookingDetails?.id">

      <ion-row>

        <ion-col size="12" *ngIf="bookingDetails.display_status">
          <h1 class="page-title font-19  mb-20">Status</h1>

          <ion-list lines="none" class="list-style-1">
            <ion-item class="item-status">
              <ion-label>
                <h3>{{ bookingDetails?.display_status}}</h3>
              </ion-label>
            </ion-item>
          </ion-list>
        </ion-col>

        <ion-col size="12">
          <!-- <h1 class="page-title font-19  mb-20">Session Request</h1> -->
          <!-- <div class="ion-text-center ion-padding" *ngIf="!ready">
            <ion-spinner color="light"></ion-spinner>
          </div> -->

          <!-- <div *ngIf="ready && bookingDetails.length == 0">
            <p class="no-location">No session found.</p>
          </div> -->

          <ion-list lines="none" class="list-style-1" *ngIf="ready && bookingDetails"
            (click)="goToCustomer(bookingDetails?.user_info?.user_id)">
            <ion-item>
              <ion-avatar slot="start">

                <img alt="" [src]="bookingDetails.user_info?.user_image"
                  onerror="this.src='/assets/images/user1-image.jpg'" />
                <!-- <ion-text class="female-icon">
                  <ion-icon src="assets/icons/female.svg"></ion-icon>
                </ion-text> -->
              </ion-avatar>
              <ion-label>
                <h3>{{ bookingDetails?.user_info?.first_name }} {{
                  bookingDetails?.user_info?.last_name?.charAt(0).toUpperCase() }}</h3>
              </ion-label>
            </ion-item>
          </ion-list>
        </ion-col>

        <ion-col size="12" *ngIf="ready && bookingDetails">
          <ion-card>

            <ion-item class="ion-no-padding ion-align-items-start" lines="none"
              *ngIf="bookingDetails.location_details?.location_address">
              <ion-label class="mt-0">Location</ion-label>
              <ion-text slot="end">{{ bookingDetails.location_details?.location_address }}</ion-text>
            </ion-item>

            <ion-item class="ion-no-padding" lines="none" *ngIf="bookingDetails.location_details?.location_type">
              <ion-label>Location Type</ion-label>
              <ion-text slot="end">{{bookingDetails.location_details?.location_type}}</ion-text>
            </ion-item>

            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Date</ion-label>
              <ion-text slot="end">{{bookingDetails.booking_date | date: 'MM/dd/yyyy'}}</ion-text>
            </ion-item>

            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Time</ion-label>
              <ion-text slot="end">{{bookingDetails?.booking_start_time}} -
                {{bookingDetails?.booking_end_time}}</ion-text>
            </ion-item>
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Massage Category</ion-label>
              <ion-text slot="end">{{bookingDetails.treatment_name}}</ion-text>
            </ion-item>
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Duration</ion-label>
              <ion-text slot="end">{{bookingDetails.therapist_duration}} Mins</ion-text>
            </ion-item>
            <ion-item class="ion-no-padding" lines="none" *ngIf="bookingDetails.how_many_people">
              <ion-label>How many People?</ion-label>
              <ion-text slot="end">{{bookingDetails?.how_many_people}}</ion-text>
            </ion-item>

            <!-- <ion-item class="ion-no-padding" lines="none" *ngIf="bookingDetails.is_couples">
              <ion-label>Type</ion-label>
              <ion-text slot="end">{{bookingDetails?.is_couples}}</ion-text>
            </ion-item> -->
          </ion-card>
        </ion-col>

        <ion-col size="12" *ngIf="ready && bookingDetails">

          <ion-card>

            <!-- <ion-item class="ion-no-padding" lines="none" *ngIf="bookingDetails.therapist_gender">
              <ion-label>Therapist Gender</ion-label>
              <ion-text slot="end">{{bookingDetails?.therapist_gender}}</ion-text>
            </ion-item>
  
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Book Male if Female is unavailable</ion-label>
              <ion-text slot="end">{{bookingDetails?.male_if_female_is_unavailable == '1' ? 'Yes' : 'No'}}</ion-text>
            </ion-item> -->

            <ion-item class="ion-no-padding" lines="none">
              <ion-label>This massage is for
              </ion-label>
              <ion-text slot="end">{{bookingDetails?.massage_for}}</ion-text>
            </ion-item>

            <!-- <ion-item class="ion-no-padding" lines="none">
              <ion-label>Pressure Level</ion-label>
              <ion-text slot="end">{{bookingDetails?.pressure_level}}</ion-text>
            </ion-item>
  
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Music</ion-label>
              <ion-text slot="end">{{bookingDetails?.music.charAt(0).toUpperCase() + bookingDetails?.music.slice(1) }}
              </ion-text>
            </ion-item>
  
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Communication Level</ion-label>
              <ion-text slot="end">{{bookingDetails?.communication_level}}</ion-text>
            </ion-item> -->

          </ion-card>

        </ion-col>

        <ion-col size="12">
          <ion-card *ngIf="ready && bookingDetails">
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Table Details</ion-label>
              <ion-text slot="end">{{bookingDetails.location_details?.table}}</ion-text>
            </ion-item>
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Sheet Preferences</ion-label>
              <ion-text slot="end">{{bookingDetails.location_details?.sheet}}</ion-text>
            </ion-item>
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Stair Details</ion-label>
              <ion-text slot="end">{{bookingDetails.location_details?.stair}}</ion-text>
            </ion-item>
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Pet Details</ion-label>
              <ion-text slot="end">{{bookingDetails.location_details?.pet}}</ion-text>
            </ion-item>
          </ion-card>
        </ion-col>

        <ion-col size="12" *ngIf="ready && bookingDetails?.notes_for_therapist">
          <ion-card>
            <h3>Notes for Therapist</h3>
            <p>{{bookingDetails?.notes_for_therapist}}</p>
          </ion-card>
        </ion-col>

        <ion-col size="12" *ngIf="ready && bookingDetails?.location_details?.parking_directions">
          <ion-card>
            <h3>Parking Directions</h3>
            <p>
              {{bookingDetails.location_details?.parking_directions}}
            </p>
          </ion-card>
        </ion-col>

        <ion-col size="12" *ngIf="ready && bookingDetails && bookingDetails?.guest_details">
          <h1 class="page-title font-19  mb-15">Guest Details</h1>
          <ng-container *ngFor="let item of bookingDetails?.guest_details; let i = index">
            <p class="filed-label">Guest No. {{i + 1}} </p>
            <ion-card>

              <ion-item class="ion-no-padding" lines="none">
                <ion-label>Name</ion-label>
                <ion-text slot="end">{{item?.first_name}} {{item?.last_name}}</ion-text>
              </ion-item>

              <ion-item class="ion-no-padding" lines="none" *ngIf="item?.guestIdentity">
                <ion-label>Guest Gender</ion-label>
                <ion-text slot="end">{{item?.guestIdentity}}</ion-text>
              </ion-item>

              <ion-item class="ion-no-padding" lines="none" *ngIf="item?.is_minor">
                <ion-label>Minor(Age)</ion-label>
                <ion-text slot="end">{{item?.is_minor ? 'Yes' : 'No'}}</ion-text>
              </ion-item>

              <ion-item class="ion-no-padding" lines="none">
                <ion-label>Massage Type</ion-label>
                <ion-text slot="end">{{item?.selectedTreatment?.treatment ? item?.selectedTreatment.treatment :
                  bookingDetails?.treatment_name }}</ion-text>
              </ion-item>

              <ion-item class="ion-no-padding" lines="none">
                <ion-label>Duration</ion-label>
                <ion-text slot="end">{{item?.selectedTreatment?.therapist_duration ?
                  item?.selectedTreatment.therapist_duration : bookingDetails?.therapist_duration }} Minutes</ion-text>
              </ion-item>

              <ion-item class="ion-no-padding" lines="none" *ngIf="item?.therapist_gender">
                <ion-label>Therapist Gender</ion-label>
                <ion-text slot="end">{{ item?.therapist_gender }}</ion-text>
              </ion-item>

              <ion-item class="ion-no-padding" lines="none" *ngIf="item?.therapist_gender == 'Female' ">
                <ion-label>Book Male if Female is unavailable</ion-label>
                <ion-text slot="end">{{item?.male_if_female_is_unavailable == '1' ? 'Yes' : 'No'}}</ion-text>
              </ion-item>

              <ion-item class="ion-no-padding" lines="none" *ngIf="item?.therapist_gender == 'Male' ">
                <ion-label>Book Female if Male is unavailable</ion-label>
                <ion-text slot="end">{{item?.female_if_male_is_unavailable == '1' ? 'Yes' : 'No'}}</ion-text>
              </ion-item>

              <!-- <ion-item class="ion-no-padding" lines="none" *ngIf="item?.pressurelevel">
                <ion-label>Pressure Level</ion-label>
                <ion-text slot="end">{{item?.pressurelevel}}</ion-text>
              </ion-item>
  
              <ion-item class="ion-no-padding" lines="none" *ngIf="item?.communicationlevel ">
                <ion-label>Communication Level</ion-label>
                <ion-text slot="end">{{item?.communicationlevel}}</ion-text>
              </ion-item> -->

            </ion-card>
          </ng-container>

        </ion-col>

        <!-- <ion-col size="12" *ngIf="ready && bookingDetails && bookingDetails?.guest_details">
          <h1 class="page-title font-19  mb-15">Guest Details</h1>
  
          <ion-card>
  
            <div class="table-responsive">
              <table>
                <thead>
  
                  <tr>
                    <th>Name</th>
                    <th>Number</th>
                    <th>Identify</th>
                    <th>Minor(Age)</th>
                  </tr>
  
                </thead>
                <tbody>
                  <tr *ngFor="let item of bookingDetails?.guest_details">
                    <td>{{item?.first_name}} {{item?.last_name}}</td>
                    <td>{{item?.phone}}</td>
                    <td>{{item?.guestIdentity}}</td>
                    <td>{{item?.is_minor ? 'Yes' : 'No'}}</td>
                  </tr>
  
                </tbody>
  
              </table>
            </div>
  
          </ion-card>
  
        </ion-col> -->

        <ion-col size="12" *ngIf="ready && bookingDetails">
          <h1 class="section-title mb-15">Earnings</h1>
          <ion-card>
            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Base Pay</ion-label>
              <ion-text slot="end">{{bookingDetails?.base_pay_therapist | currency}}</ion-text>
            </ion-item>

            <ion-item class="ion-no-padding" lines="none">
              <ion-label>Tips</ion-label>
              <ion-text slot="end">{{bookingDetails.tip | currency}}</ion-text>
            </ion-item>

            <ion-item class="ion-no-padding" lines="none" *ngIf="bookingDetails?.bonus_tip > 0">
              <ion-label>Bonus Tip</ion-label>
              <ion-text slot="end">{{bookingDetails?.bonus_tip | currency}}</ion-text>
            </ion-item>

            <!-- <ion-item class="ion-no-padding" lines="none" *ngIf="bookingDetails?.discount > 0">
              <ion-label>Discount</ion-label>
              <ion-text slot="end">{{bookingDetails?.you_saved_discount_value | currency}}</ion-text>
            </ion-item> -->
            <ion-item class="ion-no-padding" lines="none">
              <ion-label class="font-bold text-white">Est. Total</ion-label>
              <ion-text slot="end" class="font-bold text-white">{{bookingDetails?.therapist_pay | currency}}</ion-text>
            </ion-item>
          </ion-card>
        </ion-col>

        <!-- <ion-col size="12" *ngIf="ready && bookingDetails">
          <ion-button expand="block" class="primary-btn" (click)="acceptRequest()">Accept</ion-button>
        </ion-col>
  
        <ion-col size="12" *ngIf="ready && bookingDetails">
          <ion-button expand="block" class="primary-btn-outline" (click)="ignoreRequest()">Ignore</ion-button>
        </ion-col> -->
        <!-- <ion-col size="12"> -->

      </ion-row>

      <ion-row *ngIf="ready && bookingDetails && bookingDetails.status == 1">

        <ion-col size="12">
          <h1 class="section-title mb-0">Select Available Time Slot</h1>
          <!-- <p class="helper-text mb-15">(Please select a time slot before accepting the session.)</p> -->
        </ion-col>

        <ion-col size="6" size-md="6">
          <ion-item class="field" button="true" (click)="openStartTimeModal(true)" detail="false" lines="none">
            <ion-text>{{startTimeLabel}}</ion-text>
            <ion-modal [isOpen]="isStartTimeModal" class="datetime-setting" show-backdrop="true"
              [backdropDismiss]="false">
              <ng-template>
                <ion-datetime [(ngModel)]="start_time" #popoverStartTime presentation="time"
                  (ionChange)="onStartTimeChange($event)" minuteValues="0,15,30,45" hourCycle="h12" [min]="min"
                  [max]="maxWithDuraion">
                  <ion-buttons slot="buttons">
                    <ion-button (click)="cancelStartTime()">Cancel</ion-button>
                    <ion-button (click)="doneStartTime()">Done</ion-button>
                  </ion-buttons>
                </ion-datetime>
              </ng-template>
            </ion-modal>
          </ion-item>
        </ion-col>

        <ion-col size="6" size-md="6">
          <ion-item class="field" button="true" (click)="openEndTimeModal(true)" detail="false" lines="none">
            <ion-text>{{endTimeLabel}}</ion-text>
            <ion-modal [isOpen]="isEndTimeModal" class="datetime-setting" show-backdrop="true"
              [backdropDismiss]="false">
              <ng-template>
                <ion-datetime [(ngModel)]="end_time" minuteValues="0,15,30,45" #popoverEndTime presentation="time"
                  (ionChange)="onEndTimeChange($event)" hourCycle="h12" [min]="min" [max]="max">
                  <ion-buttons slot="buttons">
                    <ion-button (click)="cancelEndTime()">Cancel</ion-button>
                    <ion-button (click)="doneEndTime()">Done</ion-button>
                  </ion-buttons>
                </ion-datetime>
              </ng-template>
            </ion-modal>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-row class="ion-margin-top">

        <ion-col size="12" size-md="12" *ngIf="bookingDetails.status == 1">
          <ion-button expand="block" class="primary-btn mb-10" (click)="acceptRequest()">Accept</ion-button>
          <!-- [disabled]="!isButtonEnabled" -->
        </ion-col>

        <!-- <ion-col size="12" size-md="6" *ngIf="bookingDetails.status == 1">
          <ion-button expand="block" class="primary-btn-outline mb-10" (click)="ignoreRequest()">Ignore</ion-button>
        </ion-col> -->

        <ion-col size="12" size-md="12" *ngIf="bookingDetails.status == 2">
          <ion-button expand="block" class="primary-btn mb-10" (click)="startRequest()">Start Session</ion-button>
        </ion-col>

        <ion-col size="12" size-md="6" *ngIf="bookingDetails.status == 7">
          <ion-button expand="block" class="primary-btn-outline mb-10"
            (click)="goCompleteSession(bookingDetails)">Session
            Complete </ion-button>
        </ion-col>

        <ion-col size="12" size-md="6" *ngIf="bookingDetails.status == 2 || bookingDetails.status == 7">
          <ion-button expand="block" class="primary-btn mb-10" (click)="goToReport(bookingDetails)">Report
            Session</ion-button>
        </ion-col>

        <ion-col size="12" size-md="6" *ngIf="bookingDetails.status == 2">
          <ion-button expand="block" class="primary-btn-outline mb-10" (click)="goToCancel(bookingDetails)">Cancel
            Session</ion-button>
        </ion-col>

        <ion-col size="12" size-md="6" offset-md="3" *ngIf="bookingDetails.status == 4 || bookingDetails.status == 5">
          <ion-button expand="block" class="primary-btn mb-10" (click)="goToReport(bookingDetails)">Report
            Session</ion-button>
        </ion-col>

      </ion-row>

    </ng-container>


  </ion-grid>
</ion-content>