<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" defaultHref="/" icon="assets/icons/back-btn-arrow.svg"></ion-back-button>
    </ion-buttons>
    <ion-title>Select Membership</ion-title>
    <!-- <ion-icon slot="end" class="question" name="help-circle" id="membership-help-trigger" *ngIf="helptext"></ion-icon> -->
  </ion-toolbar>

  <!-- <ion-popover trigger="membership-help-trigger" triggerAction="click">
    <ng-template>
      <ion-content class="ion-padding">
        <p class="text-white help-text" [innerHTML]="helptext.content"></p>
      </ion-content>
    </ng-template>
  </ion-popover> -->
</ion-header>

<ion-content>
  <ion-grid class="ion-padding" [fixed]="true">
    <ion-row *ngIf="platform != 'web'">

      <ion-col size="12" class="ion-text-center" *ngIf="is_loader">
        <ion-spinner color="light"></ion-spinner>
      </ion-col>

      <ng-container *ngIf="!is_loader && products.length > 0">
        <ion-col size="12">
          <h1 class="page-title mb-30">Select a Membership</h1>
          <!-- <p class="para-1">Pricing for 60-min massage subscriptions in 55340
            <ion-icon src="assets/icons/edit.svg"></ion-icon>
          </p> -->
        </ion-col>

        <ion-col size="12">
          <ion-card (click)="selectOption(product?.id)" [class.selected]="selectedCard === product?.id"
            *ngFor="let product of products;">
            <ion-chip class="chip" *ngIf="product.isSubscribed">Active</ion-chip>
            <h3 [innerHTML]="product?.title"></h3>
            <h1 class="dolar">{{ platform_native == 'ios' ? product?.raw?.price : product?.pricing?.price}} / month</h1>
            <p [innerHTML]="product?.description" class="ion-text-left"></p>
            <p *ngFor="let detail of product?.details" class="ion-text-left list-p-item">
              <ion-icon class="mark" name="checkmark-circle"></ion-icon> {{detail}}
            </p>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6" offset-md="3">
          <ion-button expand="block" class="primary-btn" type="submit" (click)="purchase_subscription()"
            [disabled]="!selectedCard || isProductSubscribed(selectedCard)">Continue</ion-button>
        </ion-col>
      </ng-container>

      <ion-col class="ion-text-center" size="12" *ngIf="products?.length == 0 && !is_loader">
        <p class="error">No found.</p>
      </ion-col>

    </ion-row>

    <ion-row *ngIf="platform == 'web'">

      <ion-col size="12" class="ion-text-center" *ngIf="is_loader_pwa">
        <ion-spinner color="light"></ion-spinner>
      </ion-col>

      <ng-container *ngIf="!is_loader_pwa && pwa_subscriptions.length > 0">
        <ion-col size="12">
          <h1 class="page-title mb-30">Select a Membership</h1>
        </ion-col>

        <ion-col size="12">
          <ion-card (click)="selectPwaOption(item?.id)" [class.selected]="selectedCard === item?.id"
            *ngFor="let item of pwa_subscriptions;">
            <ion-chip class="chip" *ngIf="item.isSubscribed">Active</ion-chip>
            <h3 [innerHTML]="item?.title"></h3>
            <h1 class="dolar">{{item?.price}} / {{item?.period}}</h1>
            <p [innerHTML]="item?.description" class="ion-text-left"></p>
            <!-- <p *ngFor="let data of item?.details" class="ion-text-left list-p-item">
              <ion-icon class="mark" name="checkmark-circle"></ion-icon> {{data}}
            </p> -->
            <ion-button class="primary-btn cancel-btn" (click)="cancelSubscription(item.price_id)" *ngIf="item.isSubscribed && item.purchase_platform=='pwa'">Cancel Subscription</ion-button>

          </ion-card>
        </ion-col>

        <ion-col class="ion-text-center" size="12" *ngIf="pwa_subscriptions?.length == 0 && !is_loader_pwa">
          <p class="error">No found.</p>
        </ion-col>

        <ion-col size="12">
          <h5 class="section-title mb-15">Select Payment Method</h5>
        </ion-col>

        <ion-col size="12">
          <div class="ion-text-center ion-padding" *ngIf="!ready">
            <ion-spinner color="light"></ion-spinner>
          </div>
          <div class="no-found" *ngIf="ready && paymentMethodList.cards.length === 0">
            <p>No Cards Found.</p>
          </div>

          <ion-radio-group (ionChange)="selectCard($event)">
            <ion-item lines="none" class="card-item" *ngFor="let item of paymentMethodList.cards">
              <ion-icon src="assets/icons/card-bg.svg" slot="start"></ion-icon>
              
                <ion-radio mode="md" class="choose" slot="end" [value]="item.card_id" labelPlacement="start">{{item.card_name | titlecase }} {{item.ending_in}}</ion-radio>
           
            </ion-item>
          </ion-radio-group>

          <ion-item lines="none" class="card-item" (click)="goDebitCard()">
            <ion-icon src="assets/icons/pay.svg" slot="start"></ion-icon>
            <ion-label>
              <h3>Add Payment Method</h3>
            </ion-label>
          </ion-item>
        </ion-col>

        <ion-col size="12" size-md="6" offset-md="3">
          <ion-button expand="block" class="primary-btn" type="submit" (click)="purchasePwaSubscription()"
            [disabled]="!selectedCard || !selectedPaymentMethodId || isProductSubscribed(selectedCard)">Continue</ion-button>
        </ion-col>
      </ng-container>


    </ion-row>
    <ion-row class="mt-30 mb-30" *ngIf="!is_loader">

      <ion-col size="6" class="ion-text-left" routerLink="/privacy-policy">
        <ion-text class="linkText">Privacy Policy</ion-text>
      </ion-col>

      <ion-col size="6" class="ion-text-right" routerLink="/terms-conditions">
        <ion-text class="linkText">Terms of Service</ion-text>
      </ion-col>

    </ion-row>
  </ion-grid>
</ion-content>